<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Solar Sub Hub ‚Äì Clickable Prototype</title>
    <link rel="stylesheet" href="assets/styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
  </head>
  <body>
    <header class="app-header">
      <div class="brand">
        <span class="logo">‚òÄÔ∏è</span>
        <h1>Solar Sub Hub</h1>
      </div>
      <div class="context">
        <div class="actions">
          <button class="btn" id="logout-btn" hidden>Logout</button>
        </div>
      </div>
    </header>

    <div class="app-shell">
      <nav class="sidebar">
        <div class="row between" style="margin-bottom:8px">
          <strong>Menu</strong>
          <button class="btn sm" id="nav-toggle" title="Collapse/Expand sidebar">‚üò</button>
        </div>
        <ul>
          <li><a href="#login" class="nav-link">Login</a></li>
          <li><a href="#sales" class="nav-link" style="display:none">Sales Dashboard</a></li>
          <li><a href="#sales-projects" class="nav-link" style="display:none">My Projects <span class="nav-badge" id="badge-sales"></span></a></li>
          <li><a href="#proposal" class="nav-link" style="display:none">Proposal Creation</a></li>
          <li><a href="#editor" class="nav-link" style="display:none">Proposal Editor</a></li>
          <li><a href="#financing" class="nav-link" style="display:none">Financing Selection</a></li>
          <li><a href="#calculator" class="nav-link" style="display:none">Monthly Cost Calculator</a></li>
          <li><a href="#adjust" class="nav-link" style="display:none">Cost Adjustment</a></li>
          <li><a href="#handoff" class="nav-link" style="display:none">Contractor Handoff</a></li>
          <li><a href="#finance" class="nav-link" style="display:none">Finance Dashboard</a></li>
          <li><hr/></li>
          <li class="nav-group">
            <div class="group-title" id="group-contractor" data-collapsible><span class="caret">‚ñæ</span> Contractor</div>
            <ul class="group-list">
              <li><a href="#contractor" id="nav-contractor" class="nav-link indent" title="Contractor Home" style="display:none"><span class="nav-ic">üè†</span><span class="nav-label">Home</span><span class="nav-badge" id="badge-ctr"></span></a></li>
            </ul>
          </li>
        </ul>
      </nav>

      <main class="content">
        <div id="backbar" class="backbar row gap" hidden>
          <button class="btn sm" id="back-home">‚Üê Contractor Home</button>
          <button class="btn sm" id="back-board">‚Üê Board</button>
        </div>
        <!-- Login -->
        <section id="login" class="route">
          <div class="layout onecol">
            <div class="card" style="max-width:520px">
              <h2>Login</h2>
              <form id="login-form" class="form-grid">
                <label>Name <input class="input" id="login-name" placeholder="Your name" required /></label>
                <label>Role
                  <select class="input" id="login-role">
                    <option>Sales</option>
                    <option>Contractor</option>
                    <option>Finance</option>
                    <option>Admin</option>
                  </select>
                </label>
                <div class="row gap">
                  <button class="btn primary" type="submit">Login</button>
                </div>
              </form>
            </div>
          </div>
        </section>

        <!-- Contractor Home -->
        <section id="contractor" class="route" hidden>
          <div class="layout twocol-right">
            <section class="panel">
            <div class="row between" style="margin-bottom:8px">
              <h2>Contractor Home</h2>
              <div class="row gap">
                <input id="ch-filter" placeholder="Filter by name/address" />
                <select id="ch-contractor">
                  <option value="">All contractors</option>
                  <option>SunWorks</option>
                  <option>BrightInstall</option>
                </select>
              </div>
            </div>
            <div class="tabs" data-tabs id="contractor-tabs">
              <button class="tab active" data-tab="c-overview">Overview</button>
              <button class="tab" data-tab="c-board">Board</button>
              <button class="tab" data-tab="c-list">List</button>
              <button class="tab" data-tab="c-calendar">Calendar</button>
              <button class="tab" data-tab="c-reports">Reports</button>
            </div>
            <div class="tabpanes">
              <div class="tabpane active" id="tab-c-overview">
                <div class="kpis">
                  <div class="kpi"><div class="label">Total Jobs</div><div class="value" id="ctr-total">‚Äî</div></div>
                  <div class="kpi"><div class="label">SLA at Risk</div><div class="value" id="ctr-sla">‚Äî</div></div>
                  <div class="kpi"><div class="label">Permitting</div><div class="value" id="ctr-permit">‚Äî</div></div>
                  <div class="kpi"><div class="label">Installation</div><div class="value" id="ctr-install">‚Äî</div></div>
                  <div class="kpi"><div class="label">Inspection</div><div class="value" id="ctr-inspect">‚Äî</div></div>
                  <div class="kpi"><div class="label">PTO</div><div class="value" id="ctr-pto">‚Äî</div></div>
                </div>
                <div class="card">
                  <h3>Upcoming 7 days</h3>
                  <ul id="ctr-upcoming" class="list"><li>‚Äî</li></ul>
                </div>
              </div>
              <div class="tabpane" id="tab-c-board">
                <div class="kanban" id="kanban-home"></div>
              </div>
              <div class="tabpane" id="tab-c-list">
                <div class="card">
                  <table class="table">
                    <thead><tr><th>ID</th><th>Customer</th><th>Address</th><th>Stage</th><th>Contractor</th></tr></thead>
                    <tbody id="ctr-tbody"></tbody>
                  </table>
                </div>
              </div>
              <div class="tabpane" id="tab-c-calendar">
                <div class="card"><p>Calendar (placeholder)</p></div>
              </div>
              <div class="tabpane" id="tab-c-reports">
                <div class="card"><p>Reports (placeholder)</p></div>
              </div>
            </div>
            </section>
            <aside class="panel">
              <div class="card leaf">
                <h3>Phases</h3>
                <ol class="phase-list" id="phase-list">
                  <!-- phases injected -->
                </ol>
              </div>
              <div class="card">
                <h3>Quick Actions</h3>
                <div class="row gap"><button class="btn sm" data-phase-board="permitting">View Permitting on Board</button><button class="btn sm" data-phase-board="install">View Installation on Board</button></div>
              </div>
            </aside>
          </div>
        </section>

        <!-- Pipeline Kanban -->
        <section id="pipeline" class="route" hidden>
          <div class="layout onecol">
            <div class="row between" style="margin-bottom:8px">
              <h2>Operations Pipeline</h2>
              <div class="row gap">
                <input id="pipe-filter" placeholder="Filter by name/address" />
                <select id="pipe-contractor">
                  <option value="">All contractors</option>
                  <option>SunWorks</option>
                  <option>BrightInstall</option>
                </select>
              </div>
            </div>
            <div class="kanban" id="kanban">
              <!-- columns injected -->
            </div>
          </div>
        </section>
        <!-- Proposal Creation & Integration -->
        <section id="proposal" class="route" hidden>
          <div class="layout twocol">
            <aside class="panel">
              <h2>Proposal Creation</h2>
              <ol class="stepper" id="proposal-stepper">
                <li class="step current" data-step="preflight">Preflight</li>
                <li class="step" data-step="analysis">Site Analysis</li>
                <li class="step" data-step="packages">Packages</li>
                <li class="step" data-step="review">Review</li>
              </ol>
            </aside>

            <section class="panel">
              <div class="status" id="analysis-status" hidden>
                <span class="spinner"></span> Analyzing site‚Ä¶ ~45s
              </div>

              <div class="canvas card" id="map-canvas">
                <div class="canvas-placeholder">Map/Roof Canvas</div>
              </div>

              <div class="kpis">
                <div class="kpi"><div class="label">System kW</div><div class="value" id="kpi-kw">‚Äî</div></div>
                <div class="kpi"><div class="label">Est. kWh/yr</div><div class="value" id="kpi-kwh">‚Äî</div></div>
                <div class="kpi"><div class="label">Monthly Payment</div><div class="value" id="kpi-monthly">‚Äî</div></div>
                <div class="kpi"><div class="label">Savings vs Utility</div><div class="value" id="kpi-savings">‚Äî</div></div>
              </div>

              <div class="card" id="lead-info" hidden>
                <h3>Lead</h3>
                <div id="lead-info-body">‚Äî</div>
              </div>

              <div class="card" id="preflight-card">
                <h3>Preflight Checklist</h3>
                <ul class="checklist" id="preflight-list">
                  <li data-item="address" data-check>Address available</li>
                  <li data-item="bills" data-check>Utility bills uploaded</li>
                  <li data-item="usage" data-check>Usage data extracted</li>
                  <li data-item="roof" data-check>Roof imagery available</li>
                </ul>
                <div class="row gap">
                  <button class="btn" id="mark-preflight" hidden>Mark Complete</button>
                </div>
              </div>

              <div class="cards three" id="package-cards" hidden>
                <div class="pkg card" data-tier="basic">
                  <div class="badge">Lowest Monthly</div>
                  <h3>Basic</h3>
                  <p>Coverage 90% ‚Ä¢ Std panels</p>
                  <div class="grid-2">
                    <div><small>kW</small><div class="big" data-field="kw">6.8</div></div>
                    <div><small>kWh/yr</small><div class="big" data-field="kwh">10,200</div></div>
                    <div><small>Monthly</small><div class="big" data-field="monthly">$120</div></div>
                    <div><small>Savings</small><div class="big" data-field="savings">-22%</div></div>
                  </div>
                  <button class="btn primary select-tier">Use as Baseline</button>
                </div>
                <div class="pkg card recommended" data-tier="comfort">
                  <div class="badge">Best Value</div>
                  <h3>Comfort</h3>
                  <p>Coverage 105% ‚Ä¢ Hi-eff panels</p>
                  <div class="grid-2">
                    <div><small>kW</small><div class="big" data-field="kw">7.5</div></div>
                    <div><small>kWh/yr</small><div class="big" data-field="kwh">11,300</div></div>
                    <div><small>Monthly</small><div class="big" data-field="monthly">$132</div></div>
                    <div><small>Savings</small><div class="big" data-field="savings">-28%</div></div>
                  </div>
                  <button class="btn primary select-tier">Use as Baseline</button>
                </div>
                <div class="pkg card" data-tier="luxury">
                  <div class="badge">Max Production</div>
                  <h3>Luxury</h3>
                  <p>Coverage 120% ‚Ä¢ Premium + battery</p>
                  <div class="grid-2">
                    <div><small>kW</small><div class="big" data-field="kw">8.8</div></div>
                    <div><small>kWh/yr</small><div class="big" data-field="kwh">13,300</div></div>
                    <div><small>Monthly</small><div class="big" data-field="monthly">$140</div></div>
                    <div><small>Savings</small><div class="big" data-field="savings">-35%</div></div>
                  </div>
                  <button class="btn primary select-tier">Use as Baseline</button>
                </div>
              </div>

              <div class="card" id="review-card" hidden>
                <h3>Review & Confirm</h3>
                <p id="review-summary">Choose a package to continue.</p>
                <div class="row gap"><button class="btn" id="review-back">Back to Packages</button><a class="btn primary" href="#handoff">Proceed to Contractor Handoff</a></div>
              </div>

              <div class="wizard-nav" id="proposal-nav">
                <button class="btn" id="prop-prev">Back</button>
                <div class="progress"><span id="prop-progress" style="width:0%"></span></div>
                <button class="btn primary" id="prop-next">Next</button>
              </div>
            </section>
          </div>
        </section>

        <!-- Site Survey -->
        <section id="survey" class="route" hidden>
          <div class="layout twocol">
            <aside class="panel">
              <div class="stage-header card">
                <h2>Site Survey</h2>
                <div class="row gap"><span class="tag info">Scheduled</span><span class="tag warn">SLA 2d</span></div>
              </div>
              <div class="card">
                <label>Survey Date
                  <input type="date" id="survey-date" />
                </label>
                <label>Technician
                  <input type="text" id="survey-tech" placeholder="Tech name" />
                </label>
                <button class="btn" id="survey-schedule">Save Schedule</button>
              </div>
              <div class="card">
                <h3>Checklist</h3>
                <ul class="checklist" id="survey-list">
                  <li data-check>Roof photos A/B/C</li>
                  <li data-check>MSP rating & spaces</li>
                  <li data-check>Attic/rafter photos</li>
                  <li data-check>Conduit path</li>
                  <li data-check>Customer sign-off</li>
                </ul>
              </div>
            </aside>
            <section class="panel">
              <div class="card">
                <h3>Uploads</h3>
                <div class="row gap">
                  <button class="btn" id="survey-add-photos">Add Photos</button>
                  <button class="btn" id="survey-add-folder">Add Folder</button>
                </div>
                <input type="file" id="survey-photos" accept="image/*" multiple hidden />
                <input type="file" id="survey-folder" accept="image/*" webkitdirectory directory multiple hidden />
                <div id="survey-photo-list" class="thumbs"></div>
              </div>
              <div class="card">
                <h3>Notes</h3>
                <textarea rows="6" placeholder="Field notes..."></textarea>
                <div class="row gap"><button class="btn">Save Notes</button><button class="btn primary">Submit Survey</button></div>
              </div>
            </section>
          </div>
        </section>
        
        <!-- NTP (Notice to Proceed) -->
        <section id="ntp" class="route" hidden>
          <div class="layout onecol">
            <div class="card">
              <h2>NTP ‚Äì Notice to Proceed</h2>
              <div class="row gap">
                <label class="chip"><input type="checkbox" id="ntp-initiated"/> NTP Initiated</label>
                <label class="chip"><input type="checkbox" id="ntp-inproc"/> In Process</label>
              </div>
              <div class="row gap" style="margin-top:8px">
                <button class="btn success" id="ntp-complete">Good To Proceed ‚Üí Site Survey</button>
                <button class="btn" id="ntp-denied">Denied ‚Üí End of Work</button>
              </div>
            </div>
          </div>
        </section>

        <!-- CAD / Engineering -->
        <section id="cad" class="route" hidden>
          <div class="layout twocol">
            <aside class="panel">
              <div class="stage-header card">
                <h2>Design Plans</h2>
                <div class="row gap"><span class="tag info">In Progress</span></div>
              </div>
              <div class="card">
                <h3>AHJ Requirements</h3>
                <ul class="checklist">
                  <li data-check>Setbacks verified</li>
                  <li data-check>Attachment detail</li>
                  <li data-check>Labeling plan</li>
                </ul>
              </div>
              <div class="card">
                <label class="chip"><input type="checkbox" id="design-complete"/> Design Completed</label>
                <div class="row gap" style="margin-top:8px"><button class="btn primary" id="cad-next">Proceed to True Up</button></div>
              </div>
            </aside>
            <section class="panel">
              <div class="card">
                <h3>Plan Set Versions</h3>
                <ul id="cad-versions"><li>v1 ‚Äì Draft</li></ul>
                <div class="row gap"><button class="btn" id="cad-upload">Upload New Plan Set</button><button class="btn primary" id="cad-approve">Approve for True Up</button></div>
              </div>
              <div class="card">
                <h3>BOM</h3>
                <p>Panels: 24 ‚Ä¢ Inverters: 1 ‚Ä¢ Racking: Rail‚ÄëX</p>
              </div>
            </section>
          </div>
        </section>

        <!-- True Up -->
        <section id="trueup" class="route" hidden>
          <div class="layout twocol">
            <aside class="panel">
              <div class="stage-header card">
                <h2>True Up</h2>
                <div class="row gap"><span class="tag info">Pending Customer Approval</span></div>
              </div>
              <div class="card">
                <h3>Deltas vs Proposal</h3>
                <p>kW: +0.3 ‚Ä¢ Panels: +1 ‚Ä¢ Production: +3% ‚Ä¢ Price: +$400</p>
              </div>
            </aside>
            <section class="panel">
              <div class="card">
                <h3>Change Order</h3>
                <table class="table">
                  <thead><tr><th>Item</th><th>Qty</th><th>Unit $</th><th>Total</th></tr></thead>
                  <tbody id="co-body">
                    <tr data-price="350"><td>Extra panel</td><td><input type="number" value="1" min="0" class="co-qty"/></td><td>$350</td><td class="co-total">$350</td></tr>
                    <tr data-price="120"><td>Racking</td><td><input type="number" value="1" min="0" class="co-qty"/></td><td>$120</td><td class="co-total">$120</td></tr>
                    <tr data-price="80"><td>Permit revision fee</td><td><input type="number" value="1" min="0" class="co-qty"/></td><td>$80</td><td class="co-total">$80</td></tr>
                  </tbody>
                </table>
                <div class="row between"><strong>Total:</strong><strong id="co-sum">$550</strong></div>
                <div class="row gap" style="margin-top:8px"><button class="btn">Preview CO</button><button class="btn primary">Send for E‚ÄëSign</button></div>
              </div>
              <div class="card">
                <label class="chip"><input type="checkbox" id="trueup-proceed"/> Proceed</label>
                <div class="row gap" style="margin-top:8px"><button class="btn primary" id="trueup-next">Next ‚Üí Permitting</button></div>
              </div>
            </section>
          </div>
        </section>

        <!-- Permitting -->
        <section id="permitting" class="route" hidden>
          <div class="layout twocol">
            <aside class="panel">
              <div class="stage-header card">
                <h2>Permitting</h2>
                <div class="row gap"><span class="tag info">Submitted</span></div>
              </div>
              <div class="card">
                <h3>Submission</h3>
                <p>AHJ: San Jose ‚Ä¢ Fee: $210</p>
                <button class="btn">Record Payment</button>
              </div>
            </aside>
            <section class="panel">
              <div class="card">
                <h3>RFI Thread</h3>
                <ul id="rfi-list" class="list"><li>Provide roof load calc (posted by AHJ)</li></ul>
                <div class="row gap"><input id="rfi-text" placeholder="Reply..."/><button class="btn" id="rfi-add">Post</button></div>
              </div>
              <div class="card"><h3>Status</h3>
                <div class="row gap"><label class="chip"><input type="checkbox" id="perm-init"/> Initiated</label><label class="chip"><input type="checkbox" id="perm-all"/> All Permits Approved</label></div>
                <div class="row gap" style="margin-top:8px"><button class="btn primary" id="perm-next">Next ‚Üí Ordering Material</button></div>
              </div>
            </section>
          </div>
        </section>

        <!-- Ordering Material -->
        <section id="ordering" class="route" hidden>
          <div class="layout twocol">
            <aside class="panel">
              <div class="card">
                <h2>Ordering Material</h2>
                <p>Enter all materials and track receipts.</p>
                <label class="chip"><input type="checkbox" id="ord-all"/> All Orders Received</label>
                <div class="row gap" style="margin-top:8px"><button class="btn primary" id="ord-next">Next ‚Üí Installation</button></div>
              </div>
            </aside>
            <section class="panel">
              <div class="card">
                <h3>Materials</h3>
                <table class="table" id="ord-table">
                  <thead><tr><th>Item</th><th>Qty</th><th>Received</th><th>Status</th></tr></thead>
                  <tbody></tbody>
                </table>
                <div class="row gap" style="margin-top:8px">
                  <input id="ord-name" placeholder="Item"/>
                  <input id="ord-qty" type="number" min="1" value="1" style="width:90px"/>
                  <button class="btn" id="ord-add">Add</button>
                </div>
              </div>
            </section>
          </div>
        </section>

        <!-- Installation -->
        <section id="install" class="route" hidden>
          <div class="layout twocol">
            <aside class="panel">
              <div class="stage-header card">
                <h2>Installation</h2>
                <div class="row gap"><span class="tag info">Scheduled</span></div>
              </div>
              <div class="card">
                <label>Install Date
                  <input type="date" id="install-date" />
                </label>
                <label>Crew
                  <input type="text" id="install-crew" placeholder="Crew name" />
                </label>
                <button class="btn" id="install-save">Save</button>
              </div>
            </aside>
            <section class="panel">
              <div class="card">
                <h3>Install Checklist</h3>
                <ul class="checklist">
                  <li data-check>Panels installed</li>
                  <li data-check>Battery installed</li>
                  <li data-check>Roof photos</li>
                  <li data-check>Sub Panel photos</li>
                  <li data-check>Serial numbers captured</li>
                </ul>
                <div class="row gap"><button class="btn success" id="install-complete">Complete ‚Üí Inspection</button><button class="btn" id="install-resched">Reschedule</button></div>
                <div style="margin-top:8px"><input id="install-reason" placeholder="If not feasible, enter reason"/></div>
              </div>
              <div class="card">
                <h3>Upload Photos & Serial Numbers</h3>
                <div class="row gap" style="flex-wrap:wrap">
                  <div class="u-group"><div class="row gap"><strong>Panels</strong><button class="btn sm" data-up="panels">Add Photos</button></div><div class="thumbs" id="u-panels"></div></div>
                  <div class="u-group"><div class="row gap"><strong>Battery</strong><button class="btn sm" data-up="battery">Add Photos</button></div><div class="thumbs" id="u-battery"></div></div>
                  <div class="u-group"><div class="row gap"><strong>Roof</strong><button class="btn sm" data-up="roof">Add Photos</button></div><div class="thumbs" id="u-roof"></div></div>
                  <div class="u-group"><div class="row gap"><strong>Sub Panel</strong><button class="btn sm" data-up="subpanel">Add Photos</button></div><div class="thumbs" id="u-subpanel"></div></div>
                  <div class="u-group">
                    <div class="row gap"><strong>Serial Numbers (Material)</strong><button class="btn sm" data-up="serials">Add Photos</button></div>
                    <div class="thumbs" id="u-serials"></div>
                    <div class="row gap" style="margin-top:8px"><button class="btn primary sm" id="scan-serials">Scan Serial Numbers (OCR)</button><button class="btn sm" id="clear-serials">Clear</button></div>
                    <ul class="list" id="serials-output" style="margin-top:6px"></ul>
                  </div>
                </div>
                <!-- hidden inputs for each group -->
                <input type="file" id="up-panels" accept="image/*" multiple hidden />
                <input type="file" id="up-battery" accept="image/*" multiple hidden />
                <input type="file" id="up-roof" accept="image/*" multiple hidden />
                <input type="file" id="up-subpanel" accept="image/*" multiple hidden />
                <input type="file" id="up-serials" accept="image/*" multiple hidden />
              </div>
            </section>
          </div>
        </section>

        <!-- Inspection -->
        <section id="inspection" class="route" hidden>
          <div class="layout twocol">
            <aside class="panel">
              <div class="stage-header card">
                <h2>Inspection</h2>
                <div class="row gap"><span class="tag warn">Awaiting</span></div>
              </div>
              <div class="card">
                <label>Inspection Date
                  <input type="date" id="insp-date" />
                </label>
                <div class="row gap"><button class="btn" id="insp-schedule">Schedule</button></div>
              </div>
            </aside>
            <section class="panel">
              <div class="card">
                <h3>Punch List</h3>
                <ul id="punch-list" class="list"></ul>
                <div class="row gap"><input id="punch-text" placeholder="Add punch item"/><button class="btn" id="punch-add">Add</button></div>
                <div class="row gap" style="margin-top:8px"><button class="btn success" id="insp-pass">Mark Pass</button><button class="btn" id="insp-fail">Mark Fail</button></div>
                <div style="margin-top:8px"><input id="insp-reason" placeholder="If failed, enter detailed reasons"/></div>
              </div>
            </section>
          </div>
        </section>

        <!-- PTO -->
        <section id="pto" class="route" hidden>
          <div class="layout twocol">
            <aside class="panel">
              <div class="stage-header card">
                <h2>PTO</h2>
                <div class="row gap"><span class="tag info">Interconnection</span></div>
              </div>
              <div class="card">
                <ul class="checklist">
                  <li data-check>Interconnection form submitted</li>
                  <li data-check>Meter set date recorded</li>
                  <li data-check>PTO letter uploaded</li>
                </ul>
                <div class="row gap"><label class="chip"><input type="checkbox" id="pto-approved"/> Approved</label></div>
                <div class="row gap" style="margin-top:8px"><input type="date" id="pto-turnon-date"/><button class="btn primary" id="pto-approve-btn">Approve & Set Turn-On</button><button class="btn" id="pto-resubmit">Not Approved ‚Äì Resubmit</button></div>
              </div>
            </aside>
            <section class="panel">
              <div class="card">
                <h3>Upload PTO Letter</h3>
                <button class="btn">Upload</button>
                <div class="row gap" style="margin-top:8px"><button class="btn" id="pto-mark">Mark PTO Received</button></div>
              </div>
            </section>
          </div>
        </section>

        <!-- System Turn-On -->
        <section id="turnon" class="route" hidden>
          <div class="layout twocol">
            <aside class="panel">
              <div class="stage-header card">
                <h2>System Turn‚ÄëOn</h2>
                <div class="row gap"><span class="tag success">Ready</span></div>
              </div>
              <div class="card">
                <label>Turn-On Date
                  <input type="date" id="turnon-date" />
                </label>
                <div class="row gap"><button class="btn primary" id="turnon-set">Set Turn-On Date</button></div>
              </div>
              <div class="card">
                <ul class="checklist">
                  <li data-check>App onboarding complete</li>
                  <li data-check>CTs calibrated</li>
                  <li data-check>Customer walkthrough</li>
                </ul>
              </div>
              <div class="card"><h3>Commissioning Preview</h3><p>After Turn-On we will calculate commissioning in the next step.</p></div>
                <button class="btn" id="telemetry-run">Simulate</button>
              </aside>
          </div>
        </section>

        <!-- Commissioning -->
        <section id="commissioning" class="route" hidden>
          <div class="layout twocol">
            <aside class="panel">
              <div class="stage-header card">
                <h2>Commissioning</h2>
                <div class="row gap"><span class="tag info">Closeout</span></div>
              </div>
              <div class="card">
                <h3>Commissions</h3>
                <p>Sales: <strong id="comm-sales">$0</strong> ‚Ä¢ Installer: <strong id="comm-inst">$0</strong></p>
                <div>Total: <strong id="comm-total">$0</strong></div>
                <div class="row gap" style="margin-top:8px"><button class="btn success">Approve</button></div>
              </div>
              <div class="card">
                <h3>Commission Rules</h3>
                <div class="form-grid">
                  <label>Sales Type
                    <select id="cr-sales-type">
                      <option value="percent">Percent</option>
                      <option value="fixed">Fixed</option>
                    </select>
                  </label>
                  <label>Sales Value
                    <input type="number" id="cr-sales-val" step="0.1" value="5" />
                  </label>
                  <label>Installer Type
                    <select id="cr-inst-type">
                      <option value="percent">Percent</option>
                      <option value="fixed" selected>Fixed</option>
                    </select>
                  </label>
                  <label>Installer Value
                    <input type="number" id="cr-inst-val" step="1" value="800" />
                  </label>
                </div>
                <div class="muted">Percent values represent % of CAPEX. Fixed values are in currency.</div>
              </div>
            </aside>
            <section class="panel">
              <div class="card">
                <h3>Archive & Warranties</h3>
                <ul class="checklist">
                  <li data-check>Invoices paid</li>
                  <li data-check>Warranty registered</li>
                  <li data-check>Archive ZIP generated</li>
                </ul>
                <button class="btn primary">Finalize Project</button>
              </div>
            </section>
          </div>
        </section>

        <!-- Proposal Editor -->
        <section id="editor" class="route" hidden>
          <div class="layout twocol">
            <section class="panel">
              <div class="canvas card editor-canvas" id="editor-canvas">
                <div class="canvas-toolbar">
                  <button class="btn sm" data-tool="add">+ Panel</button>
                  <button class="btn sm" data-tool="remove">- Panel</button>
                  <label class="chip"><input type="checkbox" id="lock-tier" checked /> Keep within tier</label>
                </div>
                <div class="canvas-placeholder grid">Design Canvas</div>
              </div>
              <div class="metrics-bar">
                <div>kW: <strong id="m-kw">7.5</strong></div>
                <div>kWh/yr: <strong id="m-kwh">11,300</strong></div>
                <div>CAPEX: <strong id="m-capex">$21,500</strong></div>
                <div>Monthly: <strong id="m-monthly">$132</strong></div>
                <div>Savings: <strong id="m-savings">28%</strong></div>
                <div>Payback: <strong id="m-payback">9.5y</strong></div>
              </div>
            </section>
            <aside class="panel">
              <div class="tabs" data-tabs>
                <button class="tab active" data-tab="components">Components</button>
                <button class="tab" data-tab="equipment">Equipment</button>
                <button class="tab" data-tab="versions">Versions</button>
              </div>
              <div class="tabpanes">
                <div class="tabpane active" id="tab-components">
                  <div class="card"><h3>Roof Faces</h3><p>A, B, C</p></div>
                  <div class="card"><h3>Panels</h3><p><span id="panel-count">24</span> panels placed</p></div>
                </div>
                <div class="tabpane" id="tab-equipment">
                  <div class="card"><h3>Panels</h3><button class="btn sm">Swap to Hi‚Äëeff</button></div>
                  <div class="card"><h3>Inverter</h3><button class="btn sm">Use Micro</button></div>
                </div>
                <div class="tabpane" id="tab-versions">
                  <div class="card"><h3>Versions</h3><ul id="version-list"><li>v1 ‚Ä¢ Comfort baseline</li></ul></div>
                </div>
              </div>
            </aside>
          </div>
        </section>

        <!-- Financing Selection -->
        <section id="financing" class="route" hidden>
          <div class="layout twocol">
            <aside class="panel">
              <div class="card sun" id="fin-hero">
                <h2 style="margin:0 0 6px 0">Financing</h2>
                <div class="row gap" id="fin-summary"><span class="chip">From proposal: 7.5 kW</span><span class="chip">Capex $21,500</span><span class="chip">Est. $132/mo</span></div>
              </div>
              <div class="card">
                <label>Credit Range</label>
                <input class="input" type="range" id="credit" min="550" max="800" step="10" value="700" />
                <div class="row between"><small>550</small><small id="credit-val">700</small><small>800</small></div>
              </div>
              <div class="card form-grid">
                <label>Income
                  <input class="input" type="number" id="income" value="95000" />
                </label>
                <label>DTI %
                  <input class="input" type="number" id="dti" value="28" />
                </label>
                <label>Down Payment
                  <input class="input" type="number" id="down" value="2000" />
                </label>
                <label>Goal
                  <select class="input" id="goal">
                    <option value="lowest">Lowest Monthly</option>
                    <option value="fast">Fastest Payoff</option>
                  </select>
                </label>
              </div>
              <button class="btn primary" id="run-ai">Get Recommendations</button>
            </aside>
            <section class="panel">
              <div class="cards list" id="lender-list" hidden>
                <!-- lender cards injected -->
              </div>
            </section>
          </div>
        </section>

        <!-- Monthly Cost Calculator -->
        <section id="calculator" class="route" hidden>
          <div class="layout twocol">
            <aside class="panel">
              <div class="card sky" id="calc-hero">
                <h2 style="margin:0 0 6px 0">Monthly Cost</h2>
                <div class="row gap" id="calc-summary"><span class="chip">From proposal: 7.5 kW</span><span class="chip">Capex $21,500</span><span class="chip">Est. $132/mo</span></div>
              </div>
              <div class="card form-grid">
                <label>Loan Amount
                  <input class="input" type="number" id="loan-amount" value="21500" />
                </label>
                <label>APR %
                  <input class="input" type="number" id="apr" step="0.1" value="5.0" />
                </label>
                <label>Term (months)
                  <input class="input" type="number" id="term" value="300" />
                </label>
                <label>Avg Utility Bill
                  <input class="input" type="number" id="util" value="180" />
                </label>
                <label>Utility Escalation %/yr
                  <input class="input" type="number" id="escalation" step="0.5" value="3.0" />
                </label>
              </div>
              <button class="btn" id="calc-run">Recalculate</button>
            </aside>
            <section class="panel">
              <div class="kpis">
                <div class="kpi"><div class="label">Solar Payment</div><div class="value" id="c-solar">$‚Äî</div></div>
                <div class="kpi"><div class="label">New Utility</div><div class="value" id="c-newutil">$‚Äî</div></div>
                <div class="kpi"><div class="label">Net Monthly</div><div class="value" id="c-net">$‚Äî</div></div>
                <div class="kpi"><div class="label">Savings</div><div class="value" id="c-save">‚Äî%</div></div>
              </div>
              <div class="card charts">
                <div class="barcompare">
                  <div class="bar" id="bar-before"><span>Before: $180</span></div>
                  <div class="bar" id="bar-after"><span>After: $‚Äî</span></div>
                </div>
              </div>
            </section>
          </div>
        </section>

        <!-- Sales Dashboard -->
        <section id="sales" class="route" hidden>
          <div class="layout onecol">
            <div class="row between" style="margin-bottom:6px">
              <div>
                <h2 style="margin:0">Lead Management Dashboard</h2>
                <div class="muted">Monitor your solar lead pipeline and conversion metrics</div>
              </div>
              <div class="row gap">
                <label hidden style="display:flex;align-items:center;gap:6px">Window <select id="sd-window"><option value="30">30d</option><option value="90" selected>90d</option><option value="180">180d</option></select></label>
                <label hidden style="display:flex;align-items:center;gap:6px">User <select id="sd-user"><option value="all" selected>All</option></select></label>
                <button class="btn" id="sd-refresh">Refresh</button>
                <button class="btn primary" id="sd-new">New Lead</button>
                <button class="btn" id="sd-followups">Follow-ups</button>
              </div>
            </div>
              <div class="cards three" id="sd-tiles">
              <div class="card kpi-tile tile blue" data-tile="total"><div class="tile-h"><div class="tile-title">Total Leads</div><span class="tile-ic"><svg viewBox="0 0 24 24"><path d="M16 14a4 4 0 10-8 0"/><circle cx="12" cy="7" r="3"/><path d="M3 20a7 7 0 0118 0"/></svg></span></div><div class="tile-value" id="sd-total">0</div><div class="tile-sub" id="sd-total-sub">0 today</div></div>
              <div class="card kpi-tile tile green" data-tile="qualified"><div class="tile-h"><div class="tile-title">Qualified</div><span class="tile-ic"><svg viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg></span></div><div class="tile-value" id="sd-qualified">0</div><div class="tile-sub" id="sd-qualified-sub">0.0% rate</div></div>
              <div class="card kpi-tile tile orange" data-tile="appointments"><div class="tile-h"><div class="tile-title">Appointments</div><span class="tile-ic"><svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg></span></div><div class="tile-value" id="sd-appt">0</div><div class="tile-sub" id="sd-appt-sub">0.0% from qualified</div></div>
              <div class="card kpi-tile tile purple" data-tile="new"><div class="tile-h"><div class="tile-title">New Leads</div><span class="tile-ic"><svg viewBox="0 0 24 24"><path d="M12 6v6l4 2"/><circle cx="12" cy="12" r="10"/></svg></span></div><div class="tile-value" id="sd-new-count">0</div><div class="tile-sub" id="sd-new-sub">Awaiting qualification</div></div>
              <div class="card kpi-tile tile green" data-tile="converted"><div class="tile-h"><div class="tile-title">Converted</div><span class="tile-ic"><svg viewBox="0 0 24 24"><path d="M9 12l2 2 4-4"/><circle cx="12" cy="12" r="9"/></svg></span></div><div class="tile-value" id="sd-conv">0</div><div class="tile-sub" id="sd-conv-sub">0.0% of 0</div></div>
            </div>

            <div class="layout twocol">
              <section class="panel">
                <div class="card">
                  <h3>Lead Status Breakdown</h3>
                  <ul class="list" id="sd-breakdown"></ul>
                </div>
              </section>
              <section class="panel">
                <div class="card">
                  <h3>Key Performance Indicators</h3>
                  <div class="kpi-bars">
                    <div class="kpi-bar krow ok"><span>Qualification Rate</span><div class="bar"><i id="sd-qual-rate" style="width:0%"></i><b id="sd-qual-rate-val">0.0%</b></div></div>
                    <div class="kpi-bar krow warn"><span>Appointment Rate</span><div class="bar"><i id="sd-appt-rate" style="width:0%"></i><b id="sd-appt-rate-val">0.0%</b></div></div>
                    <div class="kpi-bar krow danger"><span>Disqualification Rate</span><div class="bar"><i id="sd-disq-rate" style="width:0%"></i><b id="sd-disq-rate-val">0.0%</b></div></div>
                  </div>
                </div>
              </section>
            </div>
            <div class="card">
              <h3>Leads</h3>
              <table class="table" id="sd-table">
                <thead><tr><th>ID</th><th>Name</th><th>User</th><th>Status</th><th>Created</th><th>Actions</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Sales: My Projects (read-only) -->
        <section id="sales-projects" class="route" hidden>
          <div class="layout onecol">
            <div class="row between" style="margin-bottom:6px">
              <div>
                <h2 style="margin:0">My Projects</h2>
                <div class="muted">Read-only view of jobs you originated</div>
              </div>
            </div>
            <div id="sales-projects-root"></div>
          </div>
        </section>

        <!-- Finance Dashboard -->
        <section id="finance" class="route" hidden>
          <div class="layout onecol">
            <div class="row between" style="margin-bottom:6px">
              <div>
                <h2 style="margin:0">Finance Dashboard</h2>
                <div class="muted">Approve or reject submitted proposals</div>
              </div>
              <div class="row gap">
                <button class="btn" id="fin-refresh">Refresh</button>
              </div>
            </div>
            <div class="card">
              <h3>Pending Approvals</h3>
              <table class="table" id="fin-pending">
                <thead><tr><th>ID</th><th>Lead</th><th>Assigned</th><th>Submitted</th><th>Actions</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
            <div class="card">
              <h3>Recent Decisions</h3>
              <ul class="list" id="fin-recent"></ul>
            </div>
          </div>
        </section>
        <!-- Modal: New Lead -->
        <div id="modal-new-lead" class="modal" hidden>
          <div class="modal-card">
            <div class="row between"><h3 style="margin:0">Create New Lead</h3><button class="btn sm" id="ml-close">‚úï</button></div>
            <form id="new-lead-form" class="form-grid" style="margin-top:12px">
              <label>Full name
                <input class="input" name="fullname" id="nl-fullname" placeholder="First Last" required />
              </label>
              <label>Phone (mobile preferred)
                <input class="input" name="phone" id="nl-phone" placeholder="(555) 555-5555" />
              </label>
              <label>Email address
                <input class="input" name="email" id="nl-email" type="email" placeholder="name@email.com" />
              </label>
              <label>Service address
                <input class="input" name="serviceAddress" id="nl-address" placeholder="Street, City, State" />
              </label>
              <label>Utility provider
                <select class="input" name="utility" id="nl-utility">
                  <option>PG&E</option>
                  <option>SCE</option>
                  <option>SDG&E</option>
                  <option>LADWP</option>
                  <option>SMUD</option>
                  <option>Other</option>
                </select>
              </label>
              <label>Average electric bill ($)
                <input class="input" type="number" min="0" step="1" name="avgBill" id="nl-bill" placeholder="e.g. 150" />
              </label>
              <label>12 months usage (kWh)
                <input class="input" type="number" min="0" step="1" name="usage12" id="nl-usage" placeholder="Optional if avg bill provided" />
              </label>
              <div style="grid-column:1/-1" class="row gap">
                <label class="chip"><input type="checkbox" name="tcpa" id="nl-tcpa"/> I have TCPA consent (online or recorded verbal)</label>
              </div>
              <div class="row gap" style="margin-top:8px">
                <button type="button" class="btn" id="ml-cancel">Cancel</button>
                <button type="submit" class="btn primary">Create Lead</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Modal: Qualify Lead -->
        <div id="modal-qualify" class="modal" hidden>
          <div class="modal-card">
            <div class="row between"><h3 style="margin:0">Qualify Lead</h3><button class="btn sm" id="ql-close">‚úï</button></div>
            <form id="qualify-form" class="form-grid" style="margin-top:12px">
              <input type="hidden" id="ql-id" />
              <label>Reason
                <select class="input" id="ql-reason">
                  <option>Meets criteria</option>
                  <option>Good roof/usage</option>
                  <option>Budget fit</option>
                  <option>Other</option>
                </select>
              </label>
              <label>Appointment Date
                <input class="input" type="date" id="ql-date" />
              </label>
              <label>Appointment Time
                <input class="input" type="time" id="ql-time" />
              </label>
              <div class="card" style="grid-column:1/-1">
                <h4 style="margin:0 0 6px 0">Qualification Criteria</h4>
                <div class="form-grid" style="grid-template-columns:1fr 1fr;gap:8px">
                  <label>Monthly Bill ($)
                    <input class="input" type="number" id="ql-bill" min="0" placeholder="e.g. 150" />
                  </label>
                  <label>Roof Type
                    <select class="input" id="ql-roof-type">
                      <option>Shingle</option>
                      <option>Tile</option>
                      <option>Metal</option>
                      <option>Flat</option>
                    </select>
                  </label>
                  <label>Roof Age (years)
                    <input class="input" type="number" id="ql-roof-age" min="0" placeholder="e.g. 8" />
                  </label>
                  <label>Shade
                    <select class="input" id="ql-shade">
                      <option>None</option>
                      <option>Some</option>
                      <option>Heavy</option>
                    </select>
                  </label>
                  <label>Home Ownership
                    <select class="input" id="ql-own">
                      <option>Owner</option>
                      <option>Renter</option>
                    </select>
                  </label>
                  <label>Financing Needed
                    <select class="input" id="ql-finance">
                      <option>Yes</option>
                      <option>No</option>
                    </select>
                  </label>
                  <label>Credit Score
                    <input class="input" type="number" id="ql-creditscore" min="300" max="850" placeholder="e.g. 700" />
                  </label>
                </div>
                <small class="muted">Rule: Bill ‚â• $100 ‚Ä¢ Roof type: Shingle/Tile ‚Ä¢ Roof age ‚â§ 12y ‚Ä¢ Shade: None ‚Ä¢ Ownership: Owner ‚Ä¢ If financing: credit ‚â• 650</small>
              </div>
              <label>Notes
                <textarea class="input" id="ql-notes" rows="3" placeholder="Any details‚Ä¶"></textarea>
              </label>
              <div class="row gap" style="margin-top:8px">
                <button type="button" class="btn" id="ql-cancel">Cancel</button>
                <button type="submit" class="btn primary">Mark Qualified</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Modal: Follow-ups -->
        <div id="modal-followups" class="modal" hidden>
          <div class="modal-card">
            <div class="row between"><h3 style="margin:0">Follow-ups (stale > 7 days)</h3><button class="btn sm" id="fu-close">‚úï</button></div>
            <ul class="list" id="fu-list" style="margin-top:12px"></ul>
          </div>
        </div>

        <!-- Cost Adjustment -->
        <section id="adjust" class="route" hidden>
          <div class="layout onecol">
            <div class="card">
              <h2>Target Monthly</h2>
              <input type="range" id="target" min="80" max="180" value="130" />
              <div class="row between"><small>$80</small><strong id="target-val">$130</strong><small>$180</small></div>
            </div>
            <div class="cards three" id="suggestions">
              <div class="card suggest" data-delta="-10">
                <h3>Reduce system 2 panels</h3>
                <p>Monthly -$10 ‚Ä¢ Production -5%</p>
                <button class="btn sm">Apply</button>
              </div>
              <div class="card suggest" data-delta="-8">
                <h3>Extend term to 25y</h3>
                <p>Monthly -$8 ‚Ä¢ ROI +0.5y</p>
                <button class="btn sm">Apply</button>
              </div>
              <div class="card suggest" data-delta="-12">
                <h3>Swap to Tier‚ÄëB panels</h3>
                <p>Monthly -$12 ‚Ä¢ Warranty -2y</p>
                <button class="btn sm">Apply</button>
              </div>
            </div>
            <div class="summary">
              <div>Payment: <strong id="sum-payment">$130</strong></div>
              <div>Savings vs Utility: <strong id="sum-savings">28%</strong></div>
              <div>Coverage: <strong id="sum-coverage">105%</strong></div>
              <div class="row gap">
                <button class="btn">Revert</button>
                <button class="btn primary">Save as Option B</button>
              </div>
            </div>
          </div>
        </section>

        <!-- Contractor Handoff -->
        <section id="handoff" class="route" hidden>
          <div class="layout onecol">
            <h2>Contractor Handoff</h2>
            <ol class="stepper" id="handoff-stepper">
              <li class="step current" data-step="confirm">Confirm Proposal</li>
              <li class="step" data-step="docs">Docs Checklist</li>
              <li class="step" data-step="assign">Assign Contractor</li>
              <li class="step" data-step="schedule">Schedule</li>
              <li class="step" data-step="send">Review & Send</li>
            </ol>
            <div class="wizard card" id="handoff-wizard">
              <div class="pane" data-pane="confirm">
                <h3>Proposal Summary</h3>
                <p>Comfort package ‚Ä¢ 7.5 kW ‚Ä¢ $132/mo</p>
                <button class="btn primary next">Next</button>
              </div>
              <div class="pane" data-pane="docs" hidden>
                <h3>Documents</h3>
                <ul class="checklist">
                  <li>Customer ID ‚úì</li>
                  <li>Utility bills ‚úì</li>
                  <li>Signed proposal ‚úì</li>
                </ul>
                <button class="btn primary next">Next</button>
              </div>
              <div class="pane" data-pane="assign" hidden>
                <h3>Assign Contractor</h3>
                <div class="cards list">
                  <div class="card">SunWorks ‚Ä¢ SLA 98% ‚Ä¢ <button class="btn sm select-ctr">Select</button></div>
                  <div class="card">BrightInstall ‚Ä¢ SLA 95% ‚Ä¢ <button class="btn sm select-ctr">Select</button></div>
                </div>
                <button class="btn primary next">Next</button>
              </div>
              <div class="pane" data-pane="schedule" hidden>
                <h3>Schedule</h3>
                <p>Preferred: Next 2 weeks</p>
                <button class="btn primary next">Next</button>
              </div>
              <div class="pane" data-pane="send" hidden>
                <h3>Review & Send</h3>
                <p>Package ready to send to contractor and customer.</p>
                <button class="btn primary">Send Package</button>
              </div>
            </div>
          </div>
        </section>

      </main>
    </div>

    <div id="toast" class="toast" hidden></div>

    <script src="assets/app.js"></script>
  </body>
  </html>
